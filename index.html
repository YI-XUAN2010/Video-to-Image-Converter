<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>å½±ç‰‡è½‰åœ–ç‰‡å·¥å…·</title>

    <style>
        :root {
            --bg-color: #f4f7f9; --text-color: #333; --container-bg: #fff; --controls-bg: #ecf0f1; --input-border-color: #bdc3c7; --header-text-color: #2c3e50; --label-text-color: #34495e; --value-text-color: #e74c3c; --shadow-color: rgba(0,0,0,0.1); --status-bg: #eaf2f8; --custom-controls-bg: #fff; --custom-controls-border: #ddd; --menu-bg: #ffffff; --menu-shadow: rgba(0, 0, 0, 0.15); --accent-color: #007bff; --accent-color-hover: #0056b3;
        }
        body[data-theme="dark"] {
            --bg-color: #121212; --text-color: #e0e0e0; --container-bg: #1e1e1e; --controls-bg: #2c2c2c; --input-border-color: #555; --header-text-color: #e0e0e0; --label-text-color: #c0c0c0; --value-text-color: #ff6b6b; --shadow-color: rgba(0,0,0,0.4); --status-bg: #333; --custom-controls-bg: #252525; --custom-controls-border: #444; --menu-bg: #333333; --menu-shadow: rgba(0, 0, 0, 0.5); --accent-color: #3498db; --accent-color-hover: #2980b9; 
        }
        html, body { min-height: 100%; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; box-sizing: border-box; display: flex; justify-content: center; align-items: flex-start; transition: background-color 0.3s, color 0.3s; }
        .container { width: 100%; max-width: 1000px; background-color: var(--container-bg); padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px var(--shadow-color); transition: background-color 0.3s; margin-top: 10px; }
        @media (min-width: 600px) { body { align-items: center; } .container { padding: 30px; margin-top: 0; } }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .icon-container { position: relative; }
        .icon-btn { background: none; border: none; cursor: pointer; padding: 8px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; line-height: 1; transition: opacity 0.2s; }
        .icon-btn:hover { background-color: var(--controls-bg); }
        .menu-popup { position: absolute; top: 45px; background-color: var(--menu-bg); border-radius: 8px; box-shadow: 0 2px 10px var(--menu-shadow); padding: 10px; z-index: 100; width: 200px; }
        #settings-menu { left: 0; } #lang-menu { right: 0; } #account-menu { right: 0; }
        .menu-popup .menu-section { padding: 8px; } .menu-popup .menu-section label { display: block; margin-bottom: 10px; font-weight: bold; } .menu-popup .menu-options label { display: flex; align-items: center; gap: 8px; font-weight: normal; padding: 5px; border-radius: 4px; }

        h1 { text-align: center; color: var(--header-text-color); margin: 0 0 10px 0; overflow: hidden; }
        
        #plan-display { text-align: center; font-weight: bold; margin-bottom: 20px; font-size: 16px; color: var(--accent-color); }

        #key-section { background-color: var(--controls-bg); padding: 20px; border-radius: 8px; margin-bottom: 30px; text-align: center; }
        #key-section label { display: block; margin-bottom: 10px; font-size: 18px; font-weight: bold; color: var(--label-text-color); }
        #key-input { width: 100%; max-width: 320px; padding: 12px; border-radius: 5px; border: 1px solid var(--input-border-color); background-color: var(--container-bg); color: var(--text-color); box-sizing: border-box; font-family: 'Courier New', Courier, monospace; font-size: 16px; text-align: center; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 15px; }
        .key-buttons { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        #key-submit-btn, #trial-btn { padding: 12px 20px; font-size: 16px; font-weight: bold; color: #fff; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        #key-submit-btn { background-color: var(--accent-color); } #key-submit-btn:hover { background-color: var(--accent-color-hover); }
        #trial-btn { background-color: #6c757d; } #trial-btn:hover { background-color: #5a6268; }
        
        #file-selection-area { margin-bottom: 20px; opacity: 0.5; pointer-events: none; transition: opacity 0.5s; }
        #file-selection-area.unlocked { opacity: 1; pointer-events: auto; }

        .controls { background-color: var(--controls-bg); display: flex; flex-direction: column; gap: 20px; margin-bottom: 30px; padding: 20px; border-radius: 8px; transition: opacity 0.5s, filter 0.5s; }
        .control-group { display: flex; flex-direction: column; }
        .controls.disabled { opacity: 0.5; pointer-events: none; filter: blur(2px); }
        
        label { margin-bottom: 8px; font-weight: bold; color: var(--label-text-color); }
        .file-input-wrapper { display: flex; align-items: center; gap: 10px; border: 1px solid var(--input-border-color); background-color: var(--container-bg); padding: 5px; border-radius: 5px; }
        #video-input { display: none; } #custom-file-btn { background-color: #6c757d; color: white; padding: 5px 12px; border-radius: 4px; border: none; cursor: pointer; white-space: nowrap; }
        #file-name-display { flex-grow: 1; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; padding-left: 5px; opacity: 0.7; }
        #cancel-file-btn { background: none; border: none; font-size: 24px; color: var(--text-color); cursor: pointer; line-height: 1; padding: 0 5px; } #cancel-file-btn:hover { color: var(--value-text-color); }
        input[type="number"] { border: 1px solid var(--input-border-color); padding: 10px; border-radius: 5px; font-size: 14px; width: 100%; box-sizing: border-box; background-color: var(--container-bg); color: var(--text-color); }
        input[type="range"] { width: 100%; }
        #fps-value, #quality-value { color: var(--value-text-color); font-weight: bold; }
        .dimension-input { margin-bottom: 15px; } .dimension-input:last-child { margin-bottom: 0; } .dimension-input label { display: block; margin-bottom: 5px; font-weight: normal; }
        .aspect-ratio-lock-container { display: flex; align-items: center; gap: 8px; margin-bottom: 15px; cursor: pointer; } .aspect-ratio-lock-container label { font-weight: normal; }
        input[type="checkbox"] { width: 16px; height: 16px; }
        .format-options, .dimension-mode-options { display: flex; flex-wrap: wrap; gap: 20px; } .format-options label, .dimension-mode-options label { display: flex; align-items: center; gap: 5px; font-weight: normal; }
        input:disabled { cursor: not-allowed; opacity: 0.7; }
        label.disabled { color: var(--text-color); opacity: 0.5; }
        #custom-dimension-controls { margin-top: 15px; padding: 15px; background-color: var(--custom-controls-bg); border-radius: 6px; border: 1px solid var(--custom-controls-border); }
        .hidden { display: none !important; }
        #start-btn { padding: 12px 20px; }
        #cancel-conversion-btn { padding: 12px 20px; background-color: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #cancel-conversion-btn:hover { background-color: #c0392b; }
        #status { text-align: center; font-size: 18px; padding: 15px; background-color: var(--status-bg); border-radius: 5px; margin-bottom: 20px; font-weight: 500; }
        #output-container h2 { border-bottom: 2px solid var(--controls-bg); padding-bottom: 10px; margin-bottom: 20px; }
        #image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .thumbnail { width: 100%; height: auto; border-radius: 5px; box-shadow: 0 2px 5px var(--shadow-color); object-fit: cover; }
        #download-all-btn { background-color: #2ecc71; margin-bottom: 20px; } #download-all-btn:hover { background-color: #27ae60; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background-color: var(--container-bg); padding: 25px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); width: 90%; text-align: center; }
        .modal-content h2 { margin: 0 0 15px 0; color: var(--header-text-color); }
        .modal-content p { margin: 0 0 25px 0; font-size: 16px; }
        .modal-content p strong { color: var(--accent-color); font-size: 18px; }
        .modal-content button { width: 100%; padding: 12px; font-size: 16px; font-weight: bold; color: #fff; background-color: var(--accent-color); border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; margin-bottom: 10px; }
        .modal-content button:hover { background-color: var(--accent-color-hover); }
        .modal-content .close-btn { background-color: #6c757d; }
        .modal-content .close-btn:hover { background-color: #5a6268; }
        
        #plans-comparison-modal .modal-content { max-width: 700px; }
        .plans-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .plans-table th, .plans-table td { border: 1px solid var(--custom-controls-border); padding: 12px; }
        .plans-table th { background-color: var(--controls-bg); }
        .plans-table td:first-child { text-align: left; font-weight: bold; }
        .plans-table .check { color: #2ecc71; font-size: 20px; font-weight: bold; }
        .plans-table .cross { color: #e74c3c; font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <div class="top-bar">
            <div class="icon-container"> <button id="settings-btn" class="icon-btn" aria-label="è¨­å®š">âš™ï¸</button> <div id="settings-menu" class="menu-popup hidden"> <div class="menu-section"> <label data-i18n-key="theme">ä¸»é¡Œ</label> <div class="menu-options"> <label><input type="radio" name="theme" value="light"> <span data-i18n-key="themeLight">æ·ºè‰²</span></label> <label><input type="radio" name="theme" value="dark"> <span data-i18n-key="themeDark">æ·±è‰²</span></label> <label><input type="radio" name="theme" value="system"> <span data-i18n-key="themeSystem">è¦–è£ç½®è€Œå®š</span></label> </div> </div> </div> </div>
            <div class="icon-container"> <button id="account-btn" class="icon-btn hidden" aria-label="å¸³è™Ÿ">ğŸ‘¤</button> </div>
            <div class="icon-container"> <button id="lang-btn" class="icon-btn" aria-label="èªè¨€">ğŸŒ</button> <div id="lang-menu" class="menu-popup hidden"> <div class="menu-section"> <label data-i18n-key="language">èªè¨€</label> <div class="menu-options"> <label><input type="radio" name="lang" value="zh-TW"> ç¹é«”ä¸­æ–‡</label> <label><input type="radio" name="lang" value="zh-CN"> ç®€ä½“ä¸­æ–‡</label> <label><input type="radio" name="lang" value="en"> English</label> <label><input type="radio" name="lang" value="ja"> æ—¥æœ¬èª</label> <label><input type="radio" name="lang" value="ko"> í•œêµ­ì–´</label> </div> </div> </div> </div>
        </div>
        <h1 data-i18n-key="title">å½±ç‰‡è½‰åœ–ç‰‡å·¥å…·</h1>
        <div id="plan-display"></div>
        
        <div id="key-section">
            <label for="key-input" data-i18n-key="keyPrompt">è«‹è¼¸å…¥ç”¢å“é‡‘é‘°ä»¥ä½¿ç”¨å®Œæ•´åŠŸèƒ½</label>
            <!-- â­ HTML ä¿®æ”¹è™•ï¼šä¿®æ­£é‡‘é‘°æœ€å¤§é•·åº¦ -->
            <input type="text" id="key-input" data-i18n-placeholder-key="keyPlaceholder" maxlength="17">
            <div class="key-buttons">
                <button id="key-submit-btn" data-i18n-key="unlockButton">é©—è­‰é‡‘é‘°</button>
                <button id="trial-btn" data-i18n-key="trialButton">ä½¿ç”¨è©¦ç”¨ç‰ˆ</button>
            </div>
        </div>

        <div id="file-selection-area">
            <div class="control-group"> <label for="video-input" data-i18n-key="step1">1. é¸æ“‡å½±ç‰‡æª”æ¡ˆï¼š</label> <div class="file-input-wrapper"> <input type="file" id="video-input" accept="video/*"> <button id="custom-file-btn" data-i18n-key="selectFile">é¸æ“‡æª”æ¡ˆ</button> <span id="file-name-display" data-i18n-key="noFileChosen">æœªé¸æ“‡ä»»ä½•æª”æ¡ˆ</span> <button id="cancel-file-btn" class="hidden" data-i18n-key="cancel" aria-label="Cancel selection">&times;</button> </div> </div> 
        </div>

        <div class="controls disabled">
             <div class="control-group"> <label data-i18n-key="step2">2. é¸æ“‡è¼¸å‡ºæ ¼å¼ï¼š</label> <div class="format-options"> <label><input type="radio" name="format" value="image/jpeg" checked> JPG</label> <label id="png-label"><input type="radio" name="format" value="image/png"> PNG</label> </div> </div> 
             <div class="control-group"> <label for="fps-slider"><span data-i18n-key="step3">3. é¸æ“‡æ“·å–ç‡ (FPS)ï¼š</span><span id="fps-value">10</span> FPS</label> <input type="range" id="fps-slider" min="1" max="60" value="10"> </div> 
             <div class="control-group" id="quality-control-group"> <label for="quality-slider"><span data-i18n-key="step4">4. é¸æ“‡åœ–ç‰‡ç•«è³ª</span> <span data-i18n-key="step4note">(åƒ… JPG æœ‰æ•ˆ)</span>ï¼š<span id="quality-value">80</span>%</label> <input type="range" id="quality-slider" min="1" max="100" value="80"> </div> 
             <div class="control-group"> <label data-i18n-key="step5">5. é¸æ“‡è¼¸å‡ºå°ºå¯¸ï¼š</label> <div class="dimension-mode-options"> <label><input type="radio" name="dimension-mode" value="original" checked> <span data-i18n-key="useOriginalSize">ä½¿ç”¨åŸå§‹å°ºå¯¸</span></label> <label id="custom-dim-label"><input type="radio" name="dimension-mode" value="custom"> <span data-i18n-key="useCustomSize">è‡ªè¨‚å°ºå¯¸</span></label> </div> <div id="custom-dimension-controls" class="hidden"> <div class="aspect-ratio-lock-container"> <input type="checkbox" id="aspect-ratio-lock" checked> <label for="aspect-ratio-lock" data-i18n-key="lockAspectRatio">é–å®šé•·å¯¬æ¯”</label> </div> <div class="dimension-input"> <label for="length-input" data-i18n-key="length">é•·åº¦ (px)</label> <input type="number" id="length-input" data-i18n-placeholder-key="autoPlaceholder"> </div> <div class="dimension-input"> <label for="width-input" data-i18n-key="width">å¯¬åº¦ (px)</label> <input type="number" id="width-input" data-i18n-placeholder-key="autoPlaceholder"> </div> </div> </div>
            <button id="start-btn" data-i18n-key="startConversion">é–‹å§‹è½‰æ›</button>
            <button id="cancel-conversion-btn" class="hidden" data-i18n-key="cancelConversion">å–æ¶ˆè½‰æ›</button>
        </div>
        <div id="status" data-i18n-key="initialStatus">è«‹å…ˆé©—è­‰é‡‘é‘°æˆ–ä½¿ç”¨è©¦ç”¨ç‰ˆ</div>
        <div id="output-container"> <h2 data-i18n-key="preview">é è¦½åœ–ç‰‡ï¼š</h2> <button id="download-all-btn" class="hidden" data-i18n-key="downloadAll">å…¨éƒ¨ä¸‹è¼‰ç‚º ZIP</button> <div id="image-grid"></div> </div>
    </div>
    
    <div id="plan-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 data-i18n-key="account">å¸³è™Ÿè³‡è¨Š</h2>
            <p><span data-i18n-key="currentPlan">ç›®å‰æ–¹æ¡ˆ</span>: <strong id="modal-plan-name"></strong></p>
            <button id="view-plans-btn" data-i18n-key="viewPlans">æŸ¥çœ‹æ–¹æ¡ˆæ¯”è¼ƒ</button>
            <button id="upgrade-btn" data-i18n-key="upgradePlan">å‡ç´šæ–¹æ¡ˆ</button>
            <button class="close-btn" data-i18n-key="close">é—œé–‰</button>
        </div>
    </div>

    <div id="plans-comparison-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 data-i18n-key="planComparison">æ–¹æ¡ˆæ¯”è¼ƒ</h2>
            <table class="plans-table">
                <thead>
                    <tr>
                        <th data-i18n-key="feature">åŠŸèƒ½</th>
                        <th data-i18n-key="planTrial">è©¦ç”¨ç‰ˆ</th>
                        <th data-i18n-key="planBasic">åŸºç¤ç‰ˆ</th>
                        <th data-i18n-key="planAdvanced">é€²éšç‰ˆ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-i18n-key="allowPNG">PNG æ ¼å¼</td>
                        <td><span class="cross">âœ—</span></td>
                        <td><span class="check">âœ“</span></td>
                        <td><span class="check">âœ“</span></td>
                    </tr>
                    <tr>
                        <td data-i18n-key="maxFPS">æœ€é«˜æ“·å–ç‡ (FPS)</td>
                        <td>10</td>
                        <td>30</td>
                        <td>60</td>
                    </tr>
                    <tr>
                        <td data-i18n-key="maxQuality">æœ€é«˜ç•«è³ª (JPG)</td>
                        <td>35%</td>
                        <td>75%</td>
                        <td>100%</td>
                    </tr>
                    <tr>
                        <td data-i18n-key="allowCustomSize">è‡ªè¨‚å°ºå¯¸</td>
                        <td><span class="cross">âœ—</span></td>
                        <td><span class="check">âœ“</span></td>
                        <td><span class="check">âœ“</span></td>
                    </tr>
                    <tr>
                        <td data-i18n-key="maxDuration">å½±ç‰‡é•·åº¦é™åˆ¶</td>
                        <td data-i18n-key="durationTrial">30 ç§’</td>
                        <td data-i18n-key="durationBasic">15 åˆ†é˜</td>
                        <td data-i18n-key="durationAdvanced">ç„¡é™åˆ¶</td>
                    </tr>
                </tbody>
            </table>
            <button class="close-btn" data-i18n-key="close">é—œé–‰</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <script>
        // â­ JS ä¿®æ”¹è™•ï¼šæ–°å¢ç¿»è­¯è©æ¢
        const translations = {
            'zh-TW': { title: 'å½±ç‰‡è½‰åœ–ç‰‡å·¥å…·', theme: 'ä¸»é¡Œ', themeLight: 'æ·ºè‰²', themeDark: 'æ·±è‰²', themeSystem: 'è¦–è£ç½®è€Œå®š', language: 'èªè¨€', step1: '1. é¸æ“‡å½±ç‰‡æª”æ¡ˆï¼š', step2: '2. é¸æ“‡è¼¸å‡ºæ ¼å¼ï¼š', step3: '3. é¸æ“‡æ“·å–ç‡ (FPS)ï¼š', step4: '4. é¸æ“‡åœ–ç‰‡ç•«è³ª', step4note: '(åƒ… JPG æœ‰æ•ˆ)ï¼š', step5: '5. é¸æ“‡è¼¸å‡ºå°ºå¯¸ï¼š', useOriginalSize: 'ä½¿ç”¨åŸå§‹å°ºå¯¸', useCustomSize: 'è‡ªè¨‚å°ºå¯¸', lockAspectRatio: 'é–å®šé•·å¯¬æ¯”', length: 'é•·åº¦ (px)', width: 'å¯¬åº¦ (px)', autoPlaceholder: 'è‡ªå‹•', startConversion: 'é–‹å§‹è½‰æ›', initialStatus: 'è«‹å…ˆé©—è­‰é‡‘é‘°æˆ–ä½¿ç”¨è©¦ç”¨ç‰ˆ', preview: 'é è¦½åœ–ç‰‡ï¼š', downloadAll: 'å…¨éƒ¨ä¸‹è¼‰ç‚º ZIP', statusSelected: 'å·²é¸æ“‡å½±ç‰‡ï¼š{fileName}ã€‚æº–å‚™é–‹å§‹ã€‚', statusInit: 'æ­£åœ¨åˆå§‹åŒ–...', statusProgress: 'å·²æ“·å– {count} å¼µç•«æ ¼...', statusDone: 'è™•ç†å®Œæˆï¼ç¸½å…±æ“·å–äº† {count} å¼µåœ–ç‰‡ã€‚', statusZipping: 'æ­£åœ¨æ‰“åŒ… ZIP æª”æ¡ˆ...', statusZipped: 'ZIP æª”æ¡ˆå·²ä¸‹è¼‰ï¼', alertNoVideo: 'è«‹å…ˆé¸æ“‡ä¸€å€‹å½±ç‰‡æª”æ¡ˆï¼', processing: 'è™•ç†ä¸­...', selectFile: 'é¸æ“‡æª”æ¡ˆ', noFileChosen: 'æœªé¸æ“‡ä»»ä½•æª”æ¡ˆ', cancel: 'å–æ¶ˆ', keyPrompt: 'è«‹è¼¸å…¥ç”¢å“é‡‘é‘°ä»¥ä½¿ç”¨å®Œæ•´åŠŸèƒ½', keyPlaceholder: 'XXXXX-XXXXX-XXXXX', unlockButton: 'é©—è­‰é‡‘é‘°', trialButton: 'ä½¿ç”¨è©¦ç”¨ç‰ˆ', invalidKeyAlert: 'é‡‘é‘°ç„¡æ•ˆæˆ–æ ¼å¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ï¼', unlockedStatus: 'å·¥å…·å·²è§£é–ã€‚è«‹é¸æ“‡å½±ç‰‡ä¸¦è¨­å®šåƒæ•¸ã€‚', cancelConversion: 'å–æ¶ˆè½‰æ›', statusCancelled: 'è½‰æ›å·²å–æ¶ˆã€‚', planDisplay: 'ç›®å‰æ–¹æ¡ˆï¼š{plan}', planTrial: 'è©¦ç”¨ç‰ˆ', planBasic: 'åŸºç¤ç‰ˆ', planAdvanced: 'é€²éšç‰ˆ', account: 'å¸³è™Ÿè³‡è¨Š', currentPlan: 'ç›®å‰æ–¹æ¡ˆ', upgradePlan: 'å‡ç´šæ–¹æ¡ˆ', upgrade: 'å‡ç´š', close: 'é—œé–‰', durationWarningText: 'æ‚¨é¸æ“‡çš„å½±ç‰‡é•·åº¦è¶…éç›®å‰æ–¹æ¡ˆé™åˆ¶ï¼Œåªæœƒè™•ç†å‰ {seconds} ç§’çš„å…§å®¹ã€‚\n\næ˜¯å¦è¦ç¹¼çºŒï¼Ÿ', viewPlans: 'æŸ¥çœ‹æ–¹æ¡ˆæ¯”è¼ƒ', planComparison: 'æ–¹æ¡ˆæ¯”è¼ƒ', feature: 'åŠŸèƒ½', allowPNG: 'PNG æ ¼å¼', maxFPS: 'æœ€é«˜æ“·å–ç‡ (FPS)', maxQuality: 'æœ€é«˜ç•«è³ª (JPG)', allowCustomSize: 'è‡ªè¨‚å°ºå¯¸', maxDuration: 'å½±ç‰‡é•·åº¦é™åˆ¶', durationTrial: '30 ç§’', durationBasic: '15 åˆ†é˜', durationAdvanced: 'ç„¡é™åˆ¶', alertLimitExceeded: 'æ–¹æ¡ˆé™åˆ¶è­¦å‘Š', limitExceededFPS: 'é¸æ“‡çš„æ“·å–ç‡ ({value} FPS) è¶…éæ–¹æ¡ˆä¸Šé™ ({limit} FPS)ã€‚', limitExceededQuality: 'é¸æ“‡çš„ç•«è³ª ({value}%) è¶…éæ–¹æ¡ˆä¸Šé™ ({limit}%)ã€‚' },
            'zh-CN': { title: 'è§†é¢‘è½¬å›¾ç‰‡å·¥å…·', theme: 'ä¸»é¢˜', themeLight: 'æµ…è‰²', themeDark: 'æ·±è‰²', themeSystem: 'è·Ÿéšç³»ç»Ÿ', language: 'è¯­è¨€', step1: '1. é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼š', step2: '2. é€‰æ‹©è¾“å‡ºæ ¼å¼ï¼š', step3: '3. é€‰æ‹©å¸§ç‡ (FPS)ï¼š', step4: '4. é€‰æ‹©å›¾ç‰‡ç”»è´¨', step4note: '(ä»… JPG æœ‰æ•ˆ)ï¼š', step5: '5. é€‰æ‹©è¾“å‡ºå°ºå¯¸ï¼š', useOriginalSize: 'ä½¿ç”¨åŸå§‹å°ºå¯¸', useCustomSize: 'è‡ªå®šä¹‰å°ºå¯¸', lockAspectRatio: 'é”å®šé•¿å®½æ¯”', length: 'é•¿åº¦ (px)', width: 'å®½åº¦ (px)', autoPlaceholder: 'è‡ªåŠ¨', startConversion: 'å¼€å§‹è½¬æ¢', initialStatus: 'è¯·å…ˆéªŒè¯å¯†é’¥æˆ–ä½¿ç”¨è¯•ç”¨ç‰ˆ', preview: 'é¢„è§ˆå›¾ç‰‡ï¼š', downloadAll: 'å…¨éƒ¨ä¸‹è½½ä¸º ZIP', statusSelected: 'å·²é€‰æ‹©è§†é¢‘ï¼š{fileName}ã€‚å‡†å¤‡å¼€å§‹ã€‚', statusInit: 'æ­£åœ¨åˆå§‹åŒ–...', statusProgress: 'å·²æˆªå– {count} å¼ å›¾ç‰‡...', statusDone: 'å¤„ç†å®Œæˆï¼æ€»å…±æˆªå–äº† {count} å¼ å›¾ç‰‡ã€‚', statusZipping: 'æ­£åœ¨æ‰“åŒ… ZIP æ–‡ä»¶...', statusZipped: 'ZIP æ–‡ä»¶å·²ä¸‹è½½ï¼', alertNoVideo: 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼', processing: 'å¤„ç†ä¸­...', selectFile: 'é€‰æ‹©æ–‡ä»¶', noFileChosen: 'æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶', cancel: 'å–æ¶ˆ', keyPrompt: 'è¯·è¾“å…¥äº§å“å¯†é’¥ä»¥ä½¿ç”¨å®Œæ•´åŠŸèƒ½', keyPlaceholder: 'XXXXX-XXXXX-XXXXX', unlockButton: 'éªŒè¯å¯†é’¥', trialButton: 'ä½¿ç”¨è¯•ç”¨ç‰ˆ', invalidKeyAlert: 'å¯†é’¥æ— æ•ˆæˆ–æ ¼å¼é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼', unlockedStatus: 'å·¥å…·å·²è§£é”ã€‚è¯·é€‰æ‹©è§†é¢‘å¹¶è®¾å®šå‚æ•°ã€‚', cancelConversion: 'å–æ¶ˆè½¬æ¢', statusCancelled: 'è½¬æ¢å·²å–æ¶ˆã€‚', planDisplay: 'å½“å‰æ–¹æ¡ˆï¼š{plan}', planTrial: 'è¯•ç”¨ç‰ˆ', planBasic: 'åŸºç¡€ç‰ˆ', planAdvanced: 'é«˜çº§ç‰ˆ', account: 'å¸æˆ·ä¿¡æ¯', currentPlan: 'å½“å‰æ–¹æ¡ˆ', upgradePlan: 'å‡çº§æ–¹æ¡ˆ', upgrade: 'å‡çº§', close: 'å…³é—­', durationWarningText: 'æ‚¨é€‰æ‹©çš„è§†é¢‘é•¿åº¦è¶…è¿‡å½“å‰æ–¹æ¡ˆé™åˆ¶ï¼Œåªä¼šå¤„ç†å‰ {seconds} ç§’çš„å†…å®¹ã€‚\n\næ˜¯å¦è¦ç»§ç»­ï¼Ÿ', viewPlans: 'æŸ¥çœ‹æ–¹æ¡ˆæ¯”è¾ƒ', planComparison: 'æ–¹æ¡ˆæ¯”è¾ƒ', feature: 'åŠŸèƒ½', allowPNG: 'PNG æ ¼å¼', maxFPS: 'æœ€é«˜å¸§ç‡ (FPS)', maxQuality: 'æœ€é«˜ç”»è´¨ (JPG)', allowCustomSize: 'è‡ªå®šä¹‰å°ºå¯¸', maxDuration: 'è§†é¢‘é•¿åº¦é™åˆ¶', durationTrial: '30 ç§’', durationBasic: '15 åˆ†é’Ÿ', durationAdvanced: 'æ— é™åˆ¶', alertLimitExceeded: 'æ–¹æ¡ˆé™åˆ¶è­¦å‘Š', limitExceededFPS: 'é€‰æ‹©çš„å¸§ç‡ ({value} FPS) è¶…è¿‡æ–¹æ¡ˆä¸Šé™ ({limit} FPS)ã€‚', limitExceededQuality: 'é€‰æ‹©çš„ç”»è´¨ ({value}%) è¶…è¿‡æ–¹æ¡ˆä¸Šé™ ({limit}%)ã€‚' },
            'en': { title: 'Video to Image Converter', theme: 'Theme', themeLight: 'Light', themeDark: 'Dark', themeSystem: 'System', language: 'Language', step1: '1. Select Video File:', step2: '2. Select Output Format:', step3: '3. Select Frame Rate (FPS):', step4: '4. Select Image Quality', step4note: '(JPG only):', step5: '5. Select Output Size:', useOriginalSize: 'Original Size', useCustomSize: 'Custom Size', lockAspectRatio: 'Lock Aspect Ratio', length: 'Length (px)', width: 'Width (px)', autoPlaceholder: 'Auto', startConversion: 'Start Conversion', initialStatus: 'Please validate a key or use the trial version', preview: 'Preview Images:', downloadAll: 'Download All as ZIP', statusSelected: 'Selected video: {fileName}. Ready to start.', statusInit: 'Initializing...', statusProgress: 'Captured {count} frames...', statusDone: 'Completed! Captured a total of {count} images.', statusZipping: 'Zipping files...', statusZipped: 'ZIP file downloaded!', alertNoVideo: 'Please select a video file first!', processing: 'Processing...', selectFile: 'Select File', noFileChosen: 'No file chosen', cancel: 'Cancel', keyPrompt: 'Enter Product Key for Full Features', keyPlaceholder: 'XXXXX-XXXXX-XXXXX', unlockButton: 'Validate Key', trialButton: 'Use Trial Version', invalidKeyAlert: 'Invalid or malformed key, please try again!', unlockedStatus: 'Tool unlocked. Please select a video and set parameters.', cancelConversion: 'Cancel Conversion', statusCancelled: 'Conversion cancelled.', planDisplay: 'Current Plan: {plan}', planTrial: 'Trial', planBasic: 'Basic', planAdvanced: 'Advanced', account: 'Account Info', currentPlan: 'Current Plan', upgradePlan: 'Upgrade Plan', upgrade: 'Upgrade', close: 'Close', durationWarningText: 'The selected video is longer than your plan allows. Only the first {seconds} seconds will be processed.\n\nDo you want to continue?', viewPlans: 'View Plan Comparison', planComparison: 'Plan Comparison', feature: 'Feature', allowPNG: 'PNG Format', maxFPS: 'Max Frame Rate (FPS)', maxQuality: 'Max Quality (JPG)', allowCustomSize: 'Custom Size', maxDuration: 'Video Duration Limit', durationTrial: '30 Seconds', durationBasic: '15 Minutes', durationAdvanced: 'Unlimited', alertLimitExceeded: 'Plan Limit Exceeded', limitExceededFPS: 'Selected FPS ({value}) exceeds your plan limit of {limit} FPS.', limitExceededQuality: 'Selected Quality ({value}%) exceeds your plan limit of {limit}%. ' },
            'ja': { title: 'å‹•ç”»ç”»åƒå¤‰æ›', theme: 'ãƒ†ãƒ¼ãƒ', themeLight: 'ãƒ©ã‚¤ãƒˆ', themeDark: 'ãƒ€ãƒ¼ã‚¯', themeSystem: 'ãƒ‡ãƒã‚¤ã‚¹ã«å¾“ã†', language: 'è¨€èª', step1: '1. å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ:', step2: '2. å‡ºåŠ›å½¢å¼ã‚’é¸æŠ:', step3: '3. ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ (FPS):', step4: '4. ç”»è³ªã‚’é¸æŠ', step4note: '(JPG ã®ã¿):', step5: '5. å‡ºåŠ›ã‚µã‚¤ã‚ºã‚’é¸æŠ:', useOriginalSize: 'å…ƒã®ã‚µã‚¤ã‚º', useCustomSize: 'ã‚«ã‚¹ã‚¿ãƒ ã‚µã‚¤ã‚º', lockAspectRatio: 'ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’å›ºå®š', length: 'é•·ã• (px)', width: 'å¹… (px)', autoPlaceholder: 'è‡ªå‹•', startConversion: 'å¤‰æ›é–‹å§‹', initialStatus: 'ã‚­ãƒ¼ã‚’èªè¨¼ã™ã‚‹ã‹ã€è©¦ç”¨ç‰ˆã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„', preview: 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ:', downloadAll: 'ã™ã¹ã¦ZIPã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰', statusSelected: 'å‹•ç”»ã‚’é¸æŠã—ã¾ã—ãŸ: {fileName}ã€‚æº–å‚™ãŒã§ãã¾ã—ãŸã€‚', statusInit: 'åˆæœŸåŒ–ä¸­...', statusProgress: '{count} ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã—ãŸ...', statusDone: 'å®Œäº†ã—ã¾ã—ãŸï¼åˆè¨ˆ {count} æšã®ç”»åƒã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã—ãŸã€‚', statusZipping: 'ZIP ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åœ§ç¸®ä¸­...', statusZipped: 'ZIP ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸï¼', alertNoVideo: 'æœ€åˆã«ãƒ“ãƒ‡ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼', processing: 'å‡¦ç†ä¸­...', selectFile: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ', noFileChosen: 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“', cancel: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', keyPrompt: 'å…¨æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', keyPlaceholder: 'XXXXX-XXXXX-XXXXX', unlockButton: 'ã‚­ãƒ¼ã‚’èªè¨¼', trialButton: 'è©¦ç”¨ç‰ˆã‚’ä½¿ç”¨', invalidKeyAlert: 'ç„¡åŠ¹ã¾ãŸã¯å½¢å¼ãŒæ­£ã—ããªã„ã‚­ãƒ¼ã§ã™ã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ï¼', unlockedStatus: 'ãƒ„ãƒ¼ãƒ«ã®ãƒ­ãƒƒã‚¯ãŒè§£é™¤ã•ã‚Œã¾ã—ãŸã€‚ãƒ“ãƒ‡ã‚ªã‚’é¸æŠã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚', cancelConversion: 'å¤‰æ›ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«', statusCancelled: 'å¤‰æ›ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚', planDisplay: 'ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ï¼š{plan}', planTrial: 'è©¦ç”¨ç‰ˆ', planBasic: 'åŸºæœ¬ç‰ˆ', planAdvanced: 'ä¸Šç´šç‰ˆ', account: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±', currentPlan: 'ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³', upgradePlan: 'ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰', upgrade: 'ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰', close: 'é–‰ã˜ã‚‹', durationWarningText: 'é¸æŠã—ãŸå‹•ç”»ã¯ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã®åˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚æœ€åˆã®{seconds}ç§’ã®ã¿ãŒå‡¦ç†ã•ã‚Œã¾ã™ã€‚\n\ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ', viewPlans: 'ãƒ—ãƒ©ãƒ³æ¯”è¼ƒã‚’è¦‹ã‚‹', planComparison: 'ãƒ—ãƒ©ãƒ³æ¯”è¼ƒ', feature: 'æ©Ÿèƒ½', allowPNG: 'PNGå½¢å¼', maxFPS: 'æœ€å¤§ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ (FPS)', maxQuality: 'æœ€å¤§ç”»è³ª (JPG)', allowCustomSize: 'ã‚«ã‚¹ã‚¿ãƒ ã‚µã‚¤ã‚º', maxDuration: 'å‹•ç”»ã®é•·ã•ã®åˆ¶é™', durationTrial: '30ç§’', durationBasic: '15åˆ†', durationAdvanced: 'ç„¡åˆ¶é™', alertLimitExceeded: 'ãƒ—ãƒ©ãƒ³åˆ¶é™è­¦å‘Š', limitExceededFPS: 'é¸æŠã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆï¼ˆ{value} FPSï¼‰ãŒãƒ—ãƒ©ãƒ³ã®ä¸Šé™ï¼ˆ{limit} FPSï¼‰ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚', limitExceededQuality: 'é¸æŠã—ãŸç”»è³ªï¼ˆ{value}%ï¼‰ãŒãƒ—ãƒ©ãƒ³ã®ä¸Šé™ï¼ˆ{limit}%ï¼‰ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚' },
            'ko': { title: 'ë¹„ë””ì˜¤ ì´ë¯¸ì§€ ë³€í™˜', theme: 'í…Œë§ˆ', themeLight: 'ë¼ì´íŠ¸', themeDark: 'ë‹¤í¬', themeSystem: 'ì‹œìŠ¤í…œ ì„¤ì • ë”°ë¦„', language: 'ì–¸ì–´', step1: '1. ë¹„ë””ì˜¤ íŒŒì¼ ì„ íƒ:', step2: '2. ì¶œë ¥ í˜•ì‹ ì„ íƒ:', step3: '3. í”„ë ˆì„ ì†ë„ ì„ íƒ (FPS):', step4: '4. ì´ë¯¸ì§€ í’ˆì§ˆ ì„ íƒ', step4note: '(JPGë§Œ í•´ë‹¹):', step5: '5. ì¶œë ¥ í¬ê¸° ì„ íƒ:', useOriginalSize: 'ì›ë³¸ í¬ê¸°', useCustomSize: 'ì‚¬ìš©ì ì§€ì • í¬ê¸°', lockAspectRatio: 'ì¢…íš¡ë¹„ ê³ ì •', length: 'ê¸¸ì´ (px)', width: 'ë„ˆë¹„ (px)', autoPlaceholder: 'ìë™', startConversion: 'ë³€í™˜ ì‹œì‘', initialStatus: 'í‚¤ë¥¼ ì¸ì¦í•˜ê±°ë‚˜ í‰ê°€íŒì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤', preview: 'ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°:', downloadAll: 'ëª¨ë‘ ZIPìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ', statusSelected: 'ì„ íƒëœ ë¹„ë””ì˜¤: {fileName}. ì‹œì‘ ì¤€ë¹„ ì™„ë£Œ.', statusInit: 'ì´ˆê¸°í™” ì¤‘...', statusProgress: '{count} í”„ë ˆì„ ìº¡ì²˜ë¨...', statusDone: 'ì™„ë£Œ! ì´ {count}ê°œì˜ ì´ë¯¸ì§€ë¥¼ ìº¡ì²˜í–ˆìŠµë‹ˆë‹¤.', statusZipping: 'ZIP íŒŒì¼ ì••ì¶• ì¤‘...', statusZipped: 'ZIP íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!', alertNoVideo: 'ë¨¼ì € ë¹„ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•˜ì‹­ì‹œì˜¤!', processing: 'ì²˜ë¦¬ ì¤‘...', selectFile: 'íŒŒì¼ ì„ íƒ', noFileChosen: 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ', cancel: 'ì·¨ì†Œ', keyPrompt: 'ì „ì²´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì œí’ˆ í‚¤ë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤', keyPlaceholder: 'XXXXX-XXXXX-XXXXX', unlockButton: 'í‚¤ ì¸ì¦', trialButton: 'í‰ê°€íŒ ì‚¬ìš©', invalidKeyAlert: 'í‚¤ê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì‹­ì‹œì˜¤!', unlockedStatus: 'ë„êµ¬ê°€ ì ê¸ˆ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë¹„ë””ì˜¤ë¥¼ ì„ íƒí•˜ê³  ë§¤ê°œë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì‹­ì‹œì˜¤.', cancelConversion: 'ë³€í™˜ ì·¨ì†Œ', statusCancelled: 'ë³€í™˜ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', planDisplay: 'í˜„ì¬ í”Œëœ: {plan}', planTrial: 'í‰ê°€íŒ', planBasic: 'ê¸°ë³¸', planAdvanced: 'ê³ ê¸‰', account: 'ê³„ì • ì •ë³´', currentPlan: 'í˜„ì¬ í”Œëœ', upgradePlan: 'í”Œëœ ì—…ê·¸ë ˆì´ë“œ', upgrade: 'ì—…ê·¸ë ˆì´ë“œ', close: 'ë‹«ê¸°', durationWarningText: 'ì„ íƒí•œ ë¹„ë””ì˜¤ê°€ í˜„ì¬ í”Œëœì˜ ì œí•œì„ ì´ˆê³¼í•©ë‹ˆë‹¤. ì²˜ìŒ {seconds}ì´ˆë§Œ ì²˜ë¦¬ë©ë‹ˆë‹¤.\n\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', viewPlans: 'í”Œëœ ë¹„êµ ë³´ê¸°', planComparison: 'í”Œëœ ë¹„êµ', feature: 'ê¸°ëŠ¥', allowPNG: 'PNG í˜•ì‹', maxFPS: 'ìµœëŒ€ í”„ë ˆì„ ì†ë„ (FPS)', maxQuality: 'ìµœëŒ€ í™”ì§ˆ (JPG)', allowCustomSize: 'ì‚¬ìš©ì ì§€ì • í¬ê¸°', maxDuration: 'ë¹„ë””ì˜¤ ê¸¸ì´ ì œí•œ', durationTrial: '30ì´ˆ', durationBasic: '15ë¶„', durationAdvanced: 'ë¬´ì œí•œ', alertLimitExceeded: 'í”Œëœ í•œë„ ê²½ê³ ', limitExceededFPS: 'ì„ íƒí•œ FPS({value})ê°€ í”Œëœ í•œë„({limit} FPS)ë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.', limitExceededQuality: 'ì„ íƒí•œ í’ˆì§ˆ({value}%)ì´ í”Œëœ í•œë„({limit}%)ë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.' }
        };

        function initializeApp() {
            let videoFile = null, originalAspectRatio = 0, lastJpgQuality = 80, currentLang = 'zh-TW';
            let accessLevel = 'locked'; 
            let videoDuration = 0;
            let isCancelled = false;

            const planLimits = {
                trial:    { fps: 10,  quality: 35,  duration: 30,      allowPng: false, allowCustomDim: false },
                basic:    { fps: 30,  quality: 75,  duration: 900,     allowPng: true,  allowCustomDim: true },
                advanced: { fps: 60,  quality: 100, duration: Infinity,  allowPng: true,  allowCustomDim: true },
            };

            const uiElements = {
                settingsBtn: document.getElementById('settings-btn'), settingsMenu: document.getElementById('settings-menu'), themeRadios: document.querySelectorAll('input[name="theme"]'),
                langBtn: document.getElementById('lang-btn'), langMenu: document.getElementById('lang-menu'), langRadios: document.querySelectorAll('input[name="lang"]'),
                statusDiv: document.getElementById('status'), imageGrid: document.getElementById('image-grid'),
                planDisplay: document.getElementById('plan-display'),
                accountBtn: document.getElementById('account-btn'),
                planModal: document.getElementById('plan-modal'),
                modalPlanName: document.getElementById('modal-plan-name'),
                upgradeBtn: document.getElementById('upgrade-btn'),
                viewPlansBtn: document.getElementById('view-plans-btn'),
                plansComparisonModal: document.getElementById('plans-comparison-modal'),
            };
            const keyElements = {
                section: document.getElementById('key-section'), input: document.getElementById('key-input'),
                submitBtn: document.getElementById('key-submit-btn'), trialBtn: document.getElementById('trial-btn'),
            };
            const coreElements = {
                fileSelectionArea: document.getElementById('file-selection-area'),
                controlsContainer: document.querySelector('.controls'),
                videoInput: document.getElementById('video-input'), customFileBtn: document.getElementById('custom-file-btn'), fileNameDisplay: document.getElementById('file-name-display'), cancelFileBtn: document.getElementById('cancel-file-btn'),
                formatRadios: document.querySelectorAll('input[name="format"]'), pngLabel: document.getElementById('png-label'),
                fpsSlider: document.getElementById('fps-slider'), fpsValue: document.getElementById('fps-value'),
                qualitySlider: document.getElementById('quality-slider'), qualityValue: document.getElementById('quality-value'), qualityGroup: document.getElementById('quality-control-group'),
                dimensionRadios: document.querySelectorAll('input[name="dimension-mode"]'), customDimLabel: document.getElementById('custom-dim-label'), customDimensionControls: document.getElementById('custom-dimension-controls'),
                widthInput: document.getElementById('width-input'), lengthInput: document.getElementById('length-input'),
                startBtn: document.getElementById('start-btn'), cancelConversionBtn: document.getElementById('cancel-conversion-btn'), downloadAllBtn: document.getElementById('download-all-btn')
            };
            
            const getTranslation = (key, params = {}) => { let text = (translations[currentLang]?.[key]) || translations['zh-TW'][key] || key; for (const [pKey, pValue] of Object.entries(params)) { text = text.replace(`{${pKey}}`, pValue); } return text; };
            const updateLanguage = (lang) => { currentLang = lang; document.documentElement.lang = lang.split('-')[0]; document.querySelectorAll('[data-i18n-key]').forEach(el => el.textContent = getTranslation(el.dataset.i18nKey)); document.querySelectorAll('[data-i18n-placeholder-key]').forEach(el => el.placeholder = getTranslation(el.dataset.i18nPlaceholderKey)); if(accessLevel !== 'locked') { uiElements.planDisplay.textContent = getTranslation('planDisplay', { plan: getTranslation(`plan${accessLevel.charAt(0).toUpperCase() + accessLevel.slice(1)}`) }); uiElements.modalPlanName.textContent = getTranslation(`plan${accessLevel.charAt(0).toUpperCase() + accessLevel.slice(1)}`); }};
            const applyTheme = (theme) => { if (theme === 'dark') { document.body.setAttribute('data-theme', 'dark'); } else if (theme === 'light') { document.body.removeAttribute('data-theme'); } else { const p = window.matchMedia('(prefers-color-scheme: dark)').matches; document.body.toggleAttribute('data-theme', p); } };
            
            const hasUniqueChars = (str) => new Set(str).size === str.length;
            const isAllDigits = (str) => /^\d+$/.test(str);
            const isAllLetters = (str) => /^[A-Z]+$/.test(str);

            function validateKey(key) {
                const parts = key.toUpperCase().split('-');
                if (parts.length !== 3 || parts.some(p => p.length !== 5)) return null;
                const [p1, p2, p3] = parts;

                const isBasic = isAllDigits(p1) && hasUniqueChars(p1) && isAllLetters(p2) && isAllDigits(p3) && hasUniqueChars(p3);
                if (isBasic) return 'basic';

                const isAdvanced = isAllLetters(p1) && hasUniqueChars(p1) && isAllDigits(p2) && isAllLetters(p3) && hasUniqueChars(p3);
                if (isAdvanced) return 'advanced';

                return null;
            }

            // â­ JS ä¿®æ”¹è™•ï¼šæ­¤å‡½å¼ä¸å†èª¿æ•´æ»‘æ¡¿çš„ max æˆ– value
            function applyLimitations(level) {
                accessLevel = level;
                keyElements.section.style.display = 'none';
                coreElements.controlsContainer.classList.remove('disabled');
                coreElements.fileSelectionArea.classList.add('unlocked');
                uiElements.accountBtn.classList.remove('hidden');

                const planName = getTranslation(`plan${level.charAt(0).toUpperCase() + level.slice(1)}`);
                uiElements.statusDiv.textContent = getTranslation('unlockedStatus');
                uiElements.planDisplay.textContent = getTranslation('planDisplay', { plan: planName });
                uiElements.modalPlanName.textContent = planName;
                
                const limits = planLimits[level];
                const pngRadio = coreElements.pngLabel.querySelector('input');
                const customDimRadio = coreElements.customDimLabel.querySelector('input');

                pngRadio.disabled = !limits.allowPng; 
                coreElements.pngLabel.classList.toggle('disabled', !limits.allowPng);
                if (!limits.allowPng && pngRadio.checked) {
                    coreElements.formatRadios[0].checked = true;
                    coreElements.qualityGroup.classList.remove('disabled');
                }
                
                customDimRadio.disabled = !limits.allowCustomDim; 
                coreElements.customDimLabel.classList.toggle('disabled', !limits.allowCustomDim);
                if (!limits.allowCustomDim && customDimRadio.checked) {
                    coreElements.dimensionRadios[0].checked = true;
                    coreElements.customDimensionControls.classList.add('hidden');
                }
            }

            function setupEventListeners() {
                const menus = [ { btn: uiElements.settingsBtn, menu: uiElements.settingsMenu }, { btn: uiElements.langBtn, menu: uiElements.langMenu } ];
                menus.forEach(item => { item.btn.addEventListener('click', (e) => { e.stopPropagation(); const isOpening = item.menu.classList.contains('hidden'); menus.forEach(other => other.menu.classList.add('hidden')); if (isOpening) item.menu.classList.remove('hidden'); }); item.menu.addEventListener('click', e => e.stopPropagation()); });
                window.addEventListener('click', () => menus.forEach(item => item.menu.classList.add('hidden')));

                keyElements.submitBtn.addEventListener('click', () => {
                    const keyType = validateKey(keyElements.input.value);
                    if (keyType) applyLimitations(keyType); else alert(getTranslation('invalidKeyAlert'));
                });
                keyElements.trialBtn.addEventListener('click', () => applyLimitations('trial'));
                
                // â­ JS ä¿®æ”¹è™•ï¼šé‡‘é‘°è¼¸å…¥æ¡†è‡ªå‹•åŠ ä¸Š '-'
                keyElements.input.addEventListener('input', (e) => {
                    let input = e.target;
                    let value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
                    let formattedValue = '';
                    if (value.length > 0) {
                        formattedValue = value.match(/.{1,5}/g).join('-');
                    }
                    input.value = formattedValue;
                });
                
                uiElements.accountBtn.addEventListener('click', () => uiElements.planModal.classList.remove('hidden'));
                uiElements.planModal.querySelector('.close-btn').addEventListener('click', () => uiElements.planModal.classList.add('hidden'));
                uiElements.upgradeBtn.addEventListener('click', () => { uiElements.planModal.classList.add('hidden'); keyElements.section.style.display = 'block'; });
                
                uiElements.viewPlansBtn.addEventListener('click', () => {
                    uiElements.planModal.classList.add('hidden');
                    uiElements.plansComparisonModal.classList.remove('hidden');
                });
                uiElements.plansComparisonModal.querySelector('.close-btn').addEventListener('click', () => uiElements.plansComparisonModal.classList.add('hidden'));

                uiElements.themeRadios.forEach(r => r.addEventListener('change', e => { localStorage.setItem('theme', e.target.value); applyTheme(e.target.value); }));
                uiElements.langRadios.forEach(r => r.addEventListener('change', e => { localStorage.setItem('language', e.target.value); updateLanguage(e.target.value); }));

                coreElements.customFileBtn.addEventListener('click', () => coreElements.videoInput.click());

                coreElements.videoInput.addEventListener('change', (event) => {
                    videoFile = event.target.files[0];
                    if (videoFile) {
                        const vURL = URL.createObjectURL(videoFile); const video = document.createElement('video');
                        video.addEventListener('loadedmetadata', () => { 
                            videoDuration = video.duration;
                            uiElements.statusDiv.textContent = getTranslation('statusSelected', {fileName: videoFile.name}); 
                            coreElements.fileNameDisplay.textContent = videoFile.name; 
                            coreElements.fileNameDisplay.style.opacity = '1'; 
                            coreElements.cancelFileBtn.classList.remove('hidden');
                            originalAspectRatio = video.videoWidth / video.videoHeight; 
                            coreElements.widthInput.placeholder = video.videoWidth; 
                            coreElements.lengthInput.placeholder = video.videoHeight; 
                            URL.revokeObjectURL(vURL); 
                        }, { once: true });
                        video.src = vURL;
                    }
                });

                coreElements.cancelFileBtn.addEventListener('click', () => { videoFile = null; coreElements.videoInput.value = ''; coreElements.fileNameDisplay.textContent = getTranslation('noFileChosen'); coreElements.fileNameDisplay.style.opacity = '0.7'; coreElements.cancelFileBtn.classList.add('hidden'); uiElements.statusDiv.textContent = getTranslation('unlockedStatus'); });
                coreElements.fpsSlider.addEventListener('input', (e) => coreElements.fpsValue.textContent = e.target.value);
                coreElements.qualitySlider.addEventListener('input', (e) => { coreElements.qualityValue.textContent = e.target.value; lastJpgQuality = e.target.value; });
                coreElements.formatRadios.forEach(r => r.addEventListener('change', e => { const isJpg = e.target.value === 'image/jpeg'; coreElements.qualityGroup.classList.toggle('disabled', !isJpg); coreElements.qualityGroup.style.opacity = isJpg ? '1' : '0.5'; if (isJpg) { coreElements.qualitySlider.value = lastJpgQuality; coreElements.qualityValue.textContent = lastJpgQuality; } else { coreElements.qualitySlider.value = 100; coreElements.qualityValue.textContent = '100'; } }));
                coreElements.dimensionRadios.forEach(r => r.addEventListener('change', e => coreElements.customDimensionControls.classList.toggle('hidden', e.target.value !== 'custom')));
                
                coreElements.startBtn.addEventListener('click', () => { if (!videoFile) { alert(getTranslation('alertNoVideo')); return; } startConversion(); });
                coreElements.cancelConversionBtn.addEventListener('click', () => { isCancelled = true; });
                coreElements.downloadAllBtn.addEventListener('click', downloadAllImages);
            }
            
            async function startConversion() {
                // â­ JS æ–°å¢è™•ï¼šåœ¨é–‹å§‹è½‰æ›å‰ï¼Œæª¢æŸ¥è¨­å®šæ˜¯å¦è¶…éæ–¹æ¡ˆé™åˆ¶
                const limits = planLimits[accessLevel];
                const selectedFps = parseInt(coreElements.fpsSlider.value, 10);
                const selectedQuality = parseInt(coreElements.qualitySlider.value, 10);
                const isJpg = document.querySelector('input[name="format"]:checked').value === 'image/jpeg';

                const errors = [];
                if (selectedFps > limits.fps) {
                    errors.push(getTranslation('limitExceededFPS', { value: selectedFps, limit: limits.fps }));
                }
                if (isJpg && selectedQuality > limits.quality) {
                    errors.push(getTranslation('limitExceededQuality', { value: selectedQuality, limit: limits.quality }));
                }

                if (errors.length > 0) {
                    alert(`${getTranslation('alertLimitExceeded')}:\n\n- ${errors.join('\n- ')}`);
                    return; // é˜»æ­¢è½‰æ›
                }

                if (videoDuration > limits.duration) {
                    const proceed = confirm(getTranslation('durationWarningText', { seconds: limits.duration }));
                    if (!proceed) return;
                }
                
                isCancelled = false;
                coreElements.startBtn.classList.add('hidden');
                coreElements.cancelConversionBtn.classList.remove('hidden');
                uiElements.statusDiv.textContent = getTranslation('statusInit'); 
                uiElements.imageGrid.innerHTML = ''; 
                coreElements.downloadAllBtn.classList.add('hidden');

                const vURL = URL.createObjectURL(videoFile); 
                const video = document.createElement('video'); 
                video.muted = true;

                video.addEventListener('loadedmetadata', async () => {
                    const duration = Math.min(video.duration, limits.duration);
                    const selectedFormat = document.querySelector('input[name="format"]:checked').value; 
                    const quality = selectedQuality / 100; 
                    const fps = selectedFps; 
                    const interval = 1 / fps;
                    const dimMode = document.querySelector('input[name="dimension-mode"]:checked').value; 
                    let oW, oL;
                    if (dimMode === 'original' || !planLimits[accessLevel].allowCustomDim) { oW = video.videoWidth; oL = video.videoHeight; } 
                    else { oW = parseInt(coreElements.widthInput.value, 10) || video.videoWidth; oL = parseInt(coreElements.lengthInput.value, 10) || video.videoHeight; }
                    
                    const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); 
                    canvas.width = oW; canvas.height = oL;
                    let cFrames = 0;
                    
                    try {
                        for (let cTime = 0; cTime < duration; cTime += interval) {
                            if (isCancelled) break;
                            video.currentTime = cTime; 
                            await new Promise(r => video.addEventListener('seeked', r, { once: true }));
                            ctx.drawImage(video, 0, 0, video.videoWidth, video.videoHeight, 0, 0, oW, oL);
                            let dUrl = (selectedFormat === 'image/jpeg') ? canvas.toDataURL(selectedFormat, quality) : canvas.toDataURL(selectedFormat);
                            const img = document.createElement('img'); img.src = dUrl; img.classList.add('thumbnail'); img.title = `Time: ${cTime.toFixed(2)}s`; 
                            uiElements.imageGrid.appendChild(img);
                            cFrames++; 
                            uiElements.statusDiv.textContent = getTranslation('statusProgress', {count: cFrames});
                        }
                        if (isCancelled) uiElements.statusDiv.textContent = getTranslation('statusCancelled');
                        else { uiElements.statusDiv.textContent = getTranslation('statusDone', {count: cFrames}); if (cFrames > 0) coreElements.downloadAllBtn.classList.remove('hidden'); }
                    } finally {
                        coreElements.startBtn.classList.remove('hidden');
                        coreElements.cancelConversionBtn.classList.add('hidden');
                        URL.revokeObjectURL(vURL);
                    }
                });
                video.src = vURL; 
                video.load();
            }

            async function downloadAllImages() {
                uiElements.statusDiv.textContent = getTranslation('statusZipping'); 
                const zip = new JSZip(); 
                const images = uiElements.imageGrid.querySelectorAll('img');
                const selFmt = document.querySelector('input[name="format"]:checked').value; 
                const ext = selFmt === 'image/jpeg' ? 'jpg' : 'png';
                images.forEach((img, i) => { const b64 = img.src.split(',')[1]; zip.file(`frame_${String(i + 1).padStart(4, '0')}.${ext}`, b64, { base64: true }); });
                const content = await zip.generateAsync({ type: "blob" }); 
                const vName = videoFile.name.split('.').slice(0, -1).join('.'); 
                let zipName = `${vName}_frames_${ext}`; 
                if (ext === 'jpg') zipName += `_q${coreElements.qualitySlider.value}`;
                saveAs(content, `${zipName}.zip`); 
                uiElements.statusDiv.textContent = getTranslation('statusZipped');
            }

            const savedTheme = localStorage.getItem('theme') || 'system'; document.querySelector(`input[name="theme"][value="${savedTheme}"]`).checked = true; applyTheme(savedTheme);
            const savedLang = localStorage.getItem('language') || navigator.language || 'zh-TW'; let matchedLang = Object.keys(translations).find(k => savedLang.startsWith(k)) || 'zh-TW'; document.querySelector(`input[name="lang"][value="${matchedLang}"]`).checked = true; updateLanguage(matchedLang);
            setupEventListeners();
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>